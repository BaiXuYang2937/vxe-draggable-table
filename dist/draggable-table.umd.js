(function(k,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(k=typeof globalThis<"u"?globalThis:k||self,e(k.DraggableTable={},k.Vue))})(this,function(k,e){"use strict";function R(a,b,t){const l=e.reactive({isDragging:!1,startCell:null,dragData:[],isSelecting:!1,startSelection:null});return{dragState:l,handleDragStart:(h,I,r,s)=>{const _=`${s}-${r.property}`;if(!t.value.has(_))return!1;l.isDragging=!0,l.startCell={row:s,col:r.property},l.dragData=Array.from(t.value).map(w=>{const[n,c]=w.split("-");return{row:parseInt(n),col:c,value:a.data[parseInt(n)][c]}}),h.dataTransfer.effectAllowed="move",h.dataTransfer.setData("text/plain",JSON.stringify(l.dragData))},handleDragOver:h=>{l.isDragging&&(h.preventDefault(),h.dataTransfer.dropEffect="move",h.currentTarget.classList.add("drag-over"))},handleDrop:(h,I,r,s)=>{if(!l.isDragging||!l.dragData.length)return;h.preventDefault();const _=s,w=r.property;if(!l.startCell)return;const n=l.startCell.row,c=a.columns.findIndex(C=>C.prop===l.startCell.col),g=a.columns.findIndex(C=>C.prop===w),y=_-n,d=g-c,x=l.dragData.map(C=>{var o;const K=C.row+y,m=a.columns.findIndex(S=>S.prop===C.col)+d,v=(o=a.columns[m])==null?void 0:o.prop;return{from:{row:C.row,col:C.col},to:{row:K,col:v},value:C.value}});b("drag-complete",x),l.isDragging=!1,l.startCell=null,l.dragData=[]}}}function V(a,b){const t=e.ref({row:-1,col:""}),l=e.ref(null);return{editingCell:t,cellInput:l,isEditing:(r,s)=>a.editable&&t.value.row===r&&t.value.col===s,handleCellDoubleClick:(r,s,_)=>{if(!a.editable)return;const w=r[s.property];return t.value={row:_,col:s.property},e.nextTick(()=>{l.value&&(l.value.focus(),l.value.select())}),w},finishEdit:()=>{if(t.value.row===-1)return;const{row:r,col:s}=t.value;b("cell-change",{row:r,col:s,value:a.data[r][s],oldValue:a.data[r][s]}),t.value={row:-1,col:""}},startEdit:(r,s)=>{t.value={row:r,col:s},e.nextTick(()=>{l.value&&(l.value.focus(),l.value.select())})},cancelEdit:()=>{t.value={row:-1,col:""}}}}function j(a,b){const t=e.ref(new Set),l=e.ref(null),p=e.reactive({isSelecting:!1,startSelection:null}),E=(n,c,g,y)=>{if(!a.selectable)return;const d=`${y}-${g.property}`;!n.ctrlKey&&!n.metaKey&&t.value.clear(),t.value.has(d)?t.value.delete(d):t.value.add(d),w()},B=(n,c,g,y)=>{if(!a.selectable)return;const d=`${y}-${g.property}`;t.value.has(d)||(p.isSelecting=!0,p.startSelection={row:y,col:g.property},!n.ctrlKey&&!n.metaKey&&t.value.clear(),t.value.add(d),w(),n.preventDefault())},h=()=>{p.isSelecting&&(p.isSelecting=!1,p.startSelection=null)},I=(n,c,g)=>{!a.selectable||!p.isSelecting||!p.startSelection||(r(p.startSelection,{row:g,col:c.property}),w())},r=(n,c)=>{if(!a.columns)return;t.value.clear();const g=Math.min(n.row,c.row),y=Math.max(n.row,c.row),d=a.columns.findIndex(m=>m.prop===n.col),x=a.columns.findIndex(m=>m.prop===c.col),C=Math.min(d,x),K=Math.max(d,x);for(let m=g;m<=y;m++)for(let v=C;v<=K;v++){const o=`${m}-${a.columns[v].prop}`;t.value.add(o)}},s=()=>{t.value.clear(),w()},_=()=>!a.data||!a.columns?[]:Array.from(t.value).map(n=>{var y,d;const[c,g]=n.split("-");return{row:parseInt(c),col:g,value:((d=(y=a.data)==null?void 0:y[parseInt(c)])==null?void 0:d[g])??void 0}}),w=()=>{b("selection-change",new Set(t.value))};return{tableRef:l,selectedCells:t,handleCellClick:E,handleCellMouseDown:B,handleCellMouseUp:h,handleCellMouseEnter:I,clearSelection:s,getSelectedData:_,updateSelection:r}}const L={class:"draggable-table-container"},$=["data-row","data-col","draggable","onMousedown","onMouseup","onDragstart","onDragover","onDrop","onDblclick"],A=["onUpdate:modelValue"],N={key:1},U=e.defineComponent({__name:"DraggableTable",props:{data:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},draggable:{type:Boolean,default:!0},editable:{type:Boolean,default:!0},selectable:{type:Boolean,default:!0}},emits:["update:data","cell-change","drag-complete","selection-change"],setup(a,{emit:b}){const t=a,l=b;let{tableRef:p,selectedCells:E,handleCellClick:B,handleCellMouseDown:h,handleCellMouseUp:I,updateSelection:r}=j(t,l),{editingCell:s,isEditing:_,handleCellDoubleClick:w,finishEdit:n,cellInput:c}=V(t,l),{dragState:g,handleDragStart:y,handleDragOver:d,handleDrop:x}=R(t,l,E);const C=e.computed(()=>[...t.data]),K=e.computed(()=>t.columns.map(o=>typeof o!="object"||o===null?{minWidth:100}:{...o,minWidth:o.minWidth||o.width||100})),m=(o,S,O)=>{const T=`${O}-${S.property}`;return{"draggable-cell":!0,"selected-cell":E.value.has(T),"drag-over":!1}},v=o=>{(o.key==="Delete"||o.key==="Backspace")&&E.value.forEach(S=>{const[O,T]=S.split("-"),M=parseInt(O),i=t.data[M];typeof i=="object"&&i!==null&&T in i&&l("cell-change",{row:M,col:T,value:"",oldValue:i[T]})})};return e.onMounted(()=>{document.addEventListener("keydown",v)}),(o,S)=>{const O=e.resolveComponent("el-table-column"),T=e.resolveComponent("el-table");return e.openBlock(),e.createElementBlock("div",L,[e.createVNode(T,e.mergeProps({ref_key:"tableRef",ref:p,data:C.value,style:{width:"100%"}},o.$attrs,{onCellClick:e.unref(B),onCellMouseEnter:o.handleCellMouseEnter,onCellMouseLeave:o.handleCellMouseLeave}),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(K.value,M=>(e.openBlock(),e.createBlock(O,{key:M.prop,prop:M.prop,label:M.label,width:M.width,"min-width":M.minWidth},{default:e.withCtx(({row:i,column:f,$index:D})=>[e.createElementVNode("div",{class:e.normalizeClass(m(i,f,D)),"data-row":D,"data-col":f.property,draggable:e.unref(E).has(`${D}-${f.property}`),onMousedown:u=>e.unref(h)(u,i,f,D),onMouseup:u=>e.unref(I)(u,i,f,D),onDragstart:u=>e.unref(y)(u,i,f,D),onDragover:e.withModifiers(u=>e.unref(d)(u,i,f,D),["prevent"]),onDrop:u=>e.unref(x)(u,i,f,D),onDblclick:u=>e.unref(w)(i,f,D)},[e.renderSlot(o.$slots,"cell",{row:i,column:f,index:D,editing:e.unref(_)(D,f.property)},()=>[e.unref(_)(D,f.property)?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,"onUpdate:modelValue":u=>i[f.property]=u,onBlur:S[0]||(S[0]=(...u)=>e.unref(n)&&e.unref(n)(...u)),onKeyup:S[1]||(S[1]=e.withKeys((...u)=>e.unref(n)&&e.unref(n)(...u),["enter"])),class:"cell-input",ref_for:!0,ref_key:"cellInput",ref:c},null,40,A)),[[e.vModelText,i[f.property]]]):(e.openBlock(),e.createElementBlock("span",N,e.toDisplayString(i[f.property]||""),1))],!0)],42,$)]),_:2},1032,["prop","label","width","min-width"]))),128))]),_:3},16,["data","onCellClick","onCellMouseEnter","onCellMouseLeave"])])}}}),q="",P=((a,b)=>{const t=a.__vccOpts||a;for(const[l,p]of b)t[l]=p;return t})(U,[["__scopeId","data-v-2748507b"]]),J="",W={install(a,b={}){a.component(b.componentName||"DraggableTable",P),b.globalStyles!==!1&&Promise.resolve().then(()=>z)}},z=Object.freeze(Object.defineProperty({__proto__:null,default:""},Symbol.toStringTag,{value:"Module"}));k.DraggableTable=P,k.default=W,Object.defineProperties(k,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
